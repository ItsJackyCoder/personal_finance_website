<!--index.htmlè£¡é¢çš„å…§å®¹æ˜¯å¾base.htmlè£¡é¢çš„å…§å®¹ä¾†çš„-->
{% extends "base.html" %}

<!--ä¸åŒåœ°æ–¹çš„htmlè¦è²¼åœ¨é€™è£¡é¢-->
{% block content%}
<!--Modal-->
<div
  class="modal fade"
  id="introModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">æ­¡è¿ğŸ‘ğŸ‘ğŸ‘</h5>
        <!-- <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button> -->
      </div>
      <div class="modal-body">
        æ­¡è¿ä¾†åˆ°ç¾é‡‘èˆ‡è‚¡ç¥¨åº«å­˜ç®¡ç†ç³»çµ±ï¼<br />
        æ­¤ç¶²é çš„ç”¨é€”æ˜¯ç®¡ç†èˆ‡è¿½è¹¤ç¾é‡‘åŠè‚¡ç¥¨åº«å­˜çš„è®ŠåŒ–ã€‚
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-success"
          onclick="handleUnderstand()"
        >
          äº†è§£äº†
        </button>
      </div>
    </div>
  </div>
</div>

<div id="cash-info">
  <!--&#x1F4B5;æ˜¯éˆ”ç¥¨çš„emoji-->
  <h3>ç¾é‡‘åº«å­˜ ğŸ’µ</h3>
  <table class="table">
    <thead class="table-success">
      <tr>
        <th scope="col">å°å¹£ç¸½é¡</th>
        <th scope="col">ç¾é‡‘ç¸½é¡</th>
        <th scope="col">ä»Šæ—¥åŒ¯ç‡</th>
        <th scope="col">ç¾é‡‘ç¸½é¡</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>{{data["td"]}} å…ƒ</td>
        <td>{{data["ud"]}} å…ƒ</td>
        <td>{{data["currency"]}} å…ƒ</td>
        <td>{{data["total"]}} å…ƒ</td>
      </tr>
    </tbody>
  </table>

  <h5>ç¾é‡‘æ›´å‹•ç´€éŒ„</h5>
  <!--å¾bootstrapé‚£é‚Šä¾†çš„,å¯ä»¥å»åƒè€ƒé‚£é‚Šçš„tableçš„ç¯„ä¾‹-->
  <table class="table">
    <thead class="table-success">
      <tr>
        <!--col:column-->
        <th scope="col" style="display: none">ID</th>
        <th scope="col">å°å¹£</th>
        <th scope="col">ç¾é‡‘</th>
        <th scope="col">è¨»è¨˜</th>
        <th scope="col">æ™‚é–“</th>
        <th scope="col">åˆªé™¤è³‡æ–™</th>
      </tr>
    </thead>
    <tbody>
      <!--ç”¨for loopå»æŠŠindex.pyè£¡çš„ç¬¬67è¡Œçš„cash_resultè£¡é¢çš„è³‡æ–™å¡é€²è¡¨æ ¼è£¡é¢-->
      <!--cash_resultæ˜¯å€‹a list of tuple-->
      {% for data in data["cash_result"] %}
      <!--é€™è£¡é¢å°±å¯ä»¥ä½¿ç”¨data["cash_result"]é€™å€‹listè£¡é¢çš„æ¯ä¸€ç­†è³‡æ–™-->
      <tr>
        <!--style="vertical-align: middle":å‚ç›´ç½®ä¸­-->
        <td style="vertical-align: middle; display: none">{{data[0]}}</td>
        <td style="vertical-align: middle">{{data[1]}}</td>
        <td style="vertical-align: middle">{{data[2]}}</td>
        <td style="vertical-align: middle">{{data[3]}}</td>
        <td style="vertical-align: middle">{{data[4]}}</td>
        <td>
          <!--é€™è£¡ä¸èƒ½åªåšä¸€å€‹button,è€Œæ˜¯è¦ä½œä¸€å€‹form,é€™æ˜¯å› ç‚ºæˆ‘å€‘è¦é€éé€™å€‹form,
          ç•¶ä½¿ç”¨è€…æŒ‰ä¸‹ã€Œåˆªé™¤æ­¤ç­†è³‡æ–™ã€é€™å€‹buttonä¹‹å¾Œ,å®ƒæœƒå¯„é€ä¸€å€‹HTTPçš„POST request
          åˆ°æˆ‘å€‘çš„index.pyçš„ä¼ºæœå™¨,å®ƒå¯„é€requestä¹‹å¾Œ,æˆ‘å€‘çš„ä¼ºæœå™¨å†ä¾†è™•ç†é€™å€‹request-->
          <form action="/cash-delete" method="post">
            <!--ä½œä¸€å€‹æ²’äººçœ‹åˆ°çš„<input> tag-->
            <!--ç•¶ä½¿ç”¨è€…æŒ‰ä¸‹ã€Œåˆªé™¤æ­¤ç­†è³‡æ–™ã€æ™‚,data[0]é€™ç­†è³‡æ–™å°±æœƒè¢«åˆ°å¾Œç«¯çš„ä¼ºæœå™¨-->
            <input type="hidden" name="id" value="{{data[0]}}" />
            <!--btn-primary:è¨­å®šbuttonçš„èƒŒæ™¯æ˜¯è—è‰²-->
            <button class="btn btn-outline-success">åˆªé™¤æ­¤ç­†è³‡æ–™</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<hr />
<div id="stock-info">
  <!--&#x1F4C8;æ˜¯è‚¡ç¥¨çš„emoji-->
  <h3>è‚¡ç¥¨åº«å­˜ ğŸ“ˆ</h3>
  <table class="table">
    <thead class="table-success">
      <tr>
        <th scope="col">è‚¡ç¥¨ä»£è™Ÿ</th>
        <th scope="col">æŒæœ‰è‚¡æ•¸</th>
        <th scope="col">ç›®å‰è‚¡åƒ¹</th>
        <th scope="col">ç›®å‰å¸‚å€¼</th>
        <th scope="col">è‚¡ç¥¨è³‡ç”¢å æ¯”(%)</th>
        <th scope="col">è³¼è²·ç¸½æˆæœ¬(åŒ…å«æ‰‹çºŒè²»)</th>
        <th scope="col">å¹³å‡æˆæœ¬</th>
        <th scope="col">å ±é…¬ç‡(%)</th>
      </tr>
    </thead>
    <tbody>
      {% for d in data["stock_info"] %}
      <tr>
        <!--é€™è£¡çš„dæ˜¯ä¸€å€‹dictionary-->
        <td>{{d["stock_id"]}}</td>
        <td>{{d["shares"]}}</td>
        <td>{{d["current_price"]}}</td>
        <td>{{d["total_value"]}}</td>
        <td>{{d["value_percentage"]}}</td>
        <td>{{d["stock_cost"]}}</td>
        <td>{{d["average_cost"]}}</td>
        <td>{{d["rate_of_return"]}}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!--ä¸æ‡‚CSSæ²’é—œè¥¿,å› ç‚ºé€™éƒ½æ˜¯ç¶²é èª²ç¨‹è£¡çš„å…§å®¹-->
<div id="chart" style="display: flex; flex-wrap: wrap">
  <!--å»åˆ¤æ–·è¦ä¸è¦é¡¯ç¤ºfigure-->
  {% if data["show_pic_1"] %}
  <figure style="flex: 0 1 500px; margin: 10px">
    <figcaption>è‚¡ç¥¨åº«å­˜å æ¯”åœ–</figcaption>
    <img style="width: 100%" src="/static/piechart.jpg" alt="è‚¡ç¥¨åº«å­˜å æ¯”åœ–" />
  </figure>
  {% endif %} {% if data["show_pic_2"] %}
  <figure style="flex: 0 1 500px; margin: 10px">
    <figcaption>è³‡ç”¢æ¯”ä¾‹å æ¯”åœ–</figcaption>
    <img style="width: 100%" src="/static/piechart2.jpg" alt="è³‡ç”¢æ¯”ä¾‹å æ¯”åœ–" />
  </figure>
  {% endif %}
</div>

<hr />
<div id="footer" style="text-align: right; padding: 10px 0">
  ä»Šæ—¥åŒ¯ç‡è³‡æ–™ä¾†æº:
  <a href="https://tw.rter.info/howto_currencyapi.php" target="_blank">
    å…¨çƒå³æ™‚åŒ¯ç‡API
  </a>
</div>

<script>
  // ç•¶é é¢æ‰€æœ‰æ¨£å¼å’Œè³‡æºåŠ è¼‰å®Œæˆ
  window.onload = function () {
    // æª¢æŸ¥ sessionStorage ä¸­æ˜¯å¦æœ‰ "hasVisited" æ¨™è¨˜
    if (!sessionStorage.getItem("hasVisited")) {
      // ç¬¬ä¸€æ¬¡è¨ªå•ï¼Œç™¼é€è«‹æ±‚æ¸…ç©ºè³‡æ–™
      navigator.sendBeacon("/clear_data", JSON.stringify({}));

      // æ¨™è¨˜ç‚ºå·²è¨ªå•
      sessionStorage.setItem("hasVisited", "true");

      // æª¢æŸ¥ sessionStorage ä¸­æ˜¯å¦æœ‰ "modalShown" æ¨™è¨˜
      if (!sessionStorage.getItem("modalShown")) {
        // é¡¯ç¤ºæ¨¡æ…‹æ¡†
        var myModal = new bootstrap.Modal(
          document.getElementById("introModal")
        );
        myModal.show();

        // é¡¯ç¤ºéå¾Œå°‡æ¨™è¨˜å„²å­˜åˆ° sessionStorage
        sessionStorage.setItem("modalShown", "true");
      }
    }
  };

  // ç•¶æŒ‰ä¸‹äº†è§£äº†æŒ‰éˆ•æ™‚çš„äº‹ä»¶è™•ç†å‡½æ•¸
  function handleUnderstand() {
    navigator.sendBeacon("/clear_data", JSON.stringify({})); // æ¸…ç©ºè³‡æ–™

    // éš±è—å½ˆå‡ºè¦–çª—
    var myModal = bootstrap.Modal.getInstance(
      document.getElementById("introModal")
    );
    myModal.hide(); // éš±è—å½ˆå‡ºè¦–çª—

    // é‡æ–°è¼‰å…¥é é¢
    location.reload(); // é‡æ–°è¼‰å…¥é é¢
  }
</script>

<!-- å¼•å…¥ Bootstrap å’Œ JavaScript -->
<!--å½ˆè·³è¦–çª—-->
<!-- <script>
  window.onload = function () {
    // æª¢æŸ¥ sessionStorage ä¸­æ˜¯å¦æœ‰"modalShown"æ¨™è¨˜
    if (!sessionStorage.getItem("modalShown")) {
      var myModal = new bootstrap.Modal(document.getElementById("introModal"));
      myModal.show();

      // é¡¯ç¤ºéå¾Œå°‡æ¨™è¨˜å„²å­˜åˆ° sessionStorage
      sessionStorage.setItem("modalShown", "true");
    }
  };
</script> -->
{% endblock %}
